<!-- æŠ½å±‰å®¹å™¨ -->
<view class="drawer-container" wx:if="{{showDrawer}}">
    <!-- é®ç½©å±‚ -->
    <view class="mask" bindtap="closeDrawer"></view>

    <!-- æŠ½å±‰ä¸»ä½“ -->
    <view class="drawer-content">
        <!-- æ–°å¢èƒ¡ç‰Œç±»å‹é€‰æ‹© -->
        <view class="drawer-content-top">
            <view class="win-type-selector">
                <text class="selector-label">èƒ¡ç‰Œï¼š</text>
                <view class="type-buttons">
                    <view
                            class="type-btn {{winType === 'å¹³èƒ¡' ? 'active' : ''}}"
                            bindtap="selectWinType"
                            data-type="å¹³èƒ¡"
                    >
                        å¹³èƒ¡
                    </view>
                    <view
                            class="type-btn {{winType === 'è‡ªæ‘¸' ? 'active' : ''}}"
                            bindtap="selectWinType"
                            data-type="è‡ªæ‘¸"
                    >
                        è‡ªæ‘¸
                    </view>
                    <view
                            class="type-btn {{winType === 'å¤šèµ¢å®¶' ? 'active' : ''}}"
                            bindtap="selectWinType"
                            data-type="å¤šèµ¢å®¶"
                    >
                        å¤šèµ¢å®¶
                    </view>
                </view>
            </view>
            <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šæ ‡é¢˜+æ¢äººæŒ‰é’® -->
            <view class="section-header">
                <text class="section-title">ğŸ™‚ é€‰æ‹©èµ¢å®¶</text>
                <text wx:if="{{!changingPlayers}}" class="replace-btn" bindtap="startChangePlayers">ğŸ”„ ç‰Œæ¡Œæ¢äºº</text>
                <text wx:else class="replace-btn" bindtap="stopChangePlayers">ğŸ„ ç¡®è®¤</text>
            </view>

            <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šç©å®¶åˆ—è¡¨ -->
            <block wx:if="{{!changingPlayers}}">
                <view class="players-grid">
                    <view
                            wx:for="{{winPlayers}}"
                            wx:key="id"
                            class="player-card {{item.selected ? 'active' : ''}}"
                            bindtap="selectWinPlayer"
                            data-id="{{item.id}}"
                            data-selected="{{item.selected}}"
                    >
                        <image class="player-avatar" src="{{item.avatar}}"/>
                        <text class="player-name">{{item.username}}</text>
                    </view>
                </view>


                <block
                        wx:for="{{winPlayers}}"
                        wx:key="id"
                >
                    <view

                            wx:if="{{item.lastSelected}}"
                            class="detail-box"
                    >
                        <!-- å†…å®¹åŒºåŸŸ -->
                        <view class="detail-content">
                            <text class="detail-title">{{item.username}} å¾—åˆ†: </text>
                            <!-- è¿™é‡Œå¯ä»¥æ‰©å±•å…·ä½“å†…å®¹ -->
                            <view class="score-input">
                                <text>åº•åˆ†ï¼š</text>
                                <input type="number" placeholder="è¾“å…¥åˆ†æ•°"/>
                            </view>
                            <view class="score-input">
                                <text>åº•åˆ†ï¼š</text>
                                <input type="number" placeholder="è¾“å…¥åˆ†æ•°"/>
                            </view>
                            <view class="score-input">
                                <text>åº•åˆ†ï¼š</text>
                                <input type="number" placeholder="è¾“å…¥åˆ†æ•°"/>
                            </view>
                        </view>
                    </view>
                </block>


                <block wx:if="{{winType !== 'è‡ªæ‘¸'}}">
                    <view class="section-header">
                        <text class="section-title">â˜¹ï¸ é€‰æ‹©è¾“å®¶</text>
                    </view>
                    <view class="players-grid">
                        <view
                                wx:for="{{losePlayers}}"
                                wx:key="id"
                                class="player-card {{item.selected ? 'active' : ''}}"
                                bindtap="selectLosePlayer"
                                data-id="{{item.id}}"
                                data-selected="{{item.selected}}"
                        >
                            <image class="player-avatar" src="{{item.avatar}}"/>
                            <text class="player-name">{{item.username}}</text>
                        </view>
                    </view>
                </block>
            </block>
            <block wx:else>
                <scroll-view scroll-y class="scroll-view-container">
                    <view class="all-players-grid">
                        <view
                                wx:for="{{allPlayers}}"
                                wx:key="id"
                                class="all-player-card {{ item.selected ? 'active' : ''}}"
                                bindtap="selectPlayerToPlay"
                                data-id="{{item.id}}"
                                data-selected="{{item.selected}}"
                        >
                            <image class="player-avatar" src="{{item.avatar}}"/>
                            <text class="player-name">{{item.username}}</text>
                        </view>
                    </view>
                </scroll-view>
            </block>

        </view>

        <view wx:if="{{showButton}}" class="drawer-content-bottom">
            <view class="btn cancel" bindtap="closeDrawer">å–æ¶ˆ</view>
            <view class="btn confirm" bindtap="closeDrawer">ç¡®è®¤æäº¤</view>
        </view>
    </view>
</view>