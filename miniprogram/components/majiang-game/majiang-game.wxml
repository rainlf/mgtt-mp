<!-- ÊäΩÂ±âÂÆπÂô® -->
<view class="drawer-container" wx:if="{{showDrawer}}">
    <!-- ÈÅÆÁΩ©Â±Ç -->
    <view class="mask" bindtap="closeDrawer"></view>

    <!-- ÊäΩÂ±â‰∏ª‰Ωì -->
    <view class="drawer-content">
        <!-- Êñ∞Â¢ûËÉ°ÁâåÁ±ªÂûãÈÄâÊã© -->
        <view class="drawer-content-top">
            <view class="win-type-selector">
                <text class="selector-label">ËÉ°ÁâåÔºö</text>
                <view class="type-buttons">
                    <view
                            class="type-btn {{gameType === 'Âπ≥ËÉ°' ? 'active' : ''}}"
                            bindtap="selectWinType"
                            data-type="Âπ≥ËÉ°"
                    >
                        Âπ≥ËÉ°
                    </view>
                    <view
                            class="type-btn {{gameType === 'Ëá™Êë∏' ? 'active' : ''}}"
                            bindtap="selectWinType"
                            data-type="Ëá™Êë∏"
                    >
                        Ëá™Êë∏
                    </view>
                    <view
                            class="type-btn {{gameType === 'Â§öËµ¢ÂÆ∂' ? 'active' : ''}}"
                            bindtap="selectWinType"
                            data-type="Â§öËµ¢ÂÆ∂"
                    >
                        Â§öËµ¢ÂÆ∂
                    </view>
                </view>
            </view>
            <!-- Á¨¨‰∏ÄÈÉ®ÂàÜÔºöÊ†áÈ¢ò+Êç¢‰∫∫ÊåâÈíÆ -->
            <view class="section-header">
                <text class="section-title-user">üôÇ ÈÄâÊã©Ëµ¢ÂÆ∂</text>
                <text wx:if="{{!changingPlayers}}" class="replace-btn" bindtap="startChangePlayers">üîÑ ÁâåÊ°åÊç¢‰∫∫</text>
                <text wx:else class="replace-btn" bindtap="stopChangePlayers">üçÑ Á°ÆËÆ§</text>
            </view>

            <!-- Á¨¨‰∫åÈÉ®ÂàÜÔºöÁé©ÂÆ∂ÂàóË°® -->
            <block wx:if="{{!changingPlayers}}">
                <!-- ÈÄâÊã©Ëµ¢ÂÆ∂ -->
                <view class="players-grid">
                    <view
                            wx:for="{{winPlayers}}"
                            wx:key="id"
                            class="player-card {{item.selected ? 'active' : ''}}"
                            bindtap="selectWinPlayer"
                            data-id="{{item.id}}"
                            data-selected="{{item.selected}}"
                    >
                        <image class="player-avatar" src="{{item.avatar}}"/>
                        <text class="player-name">{{item.username}}</text>
                    </view>
                </view>

                <block
                        wx:for="{{winPlayers}}"
                        wx:key="id"
                >
                    <view

                            wx:if="{{item.lastSelected}}"
                            class="detail-box"
                    >
                        <!-- ÂæóÂàÜËÆ°ÁÆóÂå∫Âüü -->
                        <view class="detail-content">
                            <view class="detail-row">
                                <view class="detail-row-title">
                                    <text>{{item.username}} </text>
                                    <text class="detail-title">ÂæóÂàÜ:</text>
                                    <text style="margin-left: 10rpx">{{basePoints}}</text>
                                    <text style="margin-left: 10rpx"> x </text>
                                    <text style="margin-left: 10rpx">{{multi}}</text>
                                    <text style="margin-left: 10rpx"> = </text>
                                    <text style="margin-left: 10rpx">{{basePoints * multi}}</text>
                                </view>

                                <view
                                        class="delete-btn"
                                        bindtap="handleDelete"
                                        data-id="{{item.id}}"
                                        hover-class="delete-btn-hover"
                                >
                                    x
                                </view>
                            </view>

                            <!-- Â∫ïÂàÜÂå∫Âüü -->
                            <text class="section-title">ÈÄâÊã©Â∫ïÂàÜ</text>
                            <view class="button-row">
                                <view class="tag-group">
                                    <view
                                            wx:for="{{points}}"
                                            wx:key="index"
                                            class="tag-btn {{item.selected ? 'active' : ''}}"
                                            bindtap="selectTag"
                                            data-name="{{item.name}}"
                                            data-selected="{{item.selected}}"
                                            data-point="{{item.point}}"
                                            hover-class="tag-btn-hover"
                                    >
                                        {{item.name}}
                                    </view>
                                </view>

                                <!-- Êìç‰ΩúÊåâÈíÆÁªÑ -->
                                <view class="action-group">
                                    <view
                                            class="action-btn minus"
                                            bindtap="handleDecrease"
                                            hover-class="action-btn-hover"
                                    >
                                        <text>‚àí</text>
                                    </view>
                                    <view
                                            class="action-btn plus"
                                            bindtap="handleIncrease"
                                            hover-class="action-btn-hover"
                                    >
                                        +
                                    </view>
                                </view>
                            </view>

                            <!-- ÁâåÂûãÈÄâÊã©Âå∫Âùó -->
                            <view class="section">
                                <text class="section-title">ÈÄâÊã©ÁâåÂûã</text>
                                <view class="tile-group">
                                    <view
                                            wx:for="{{winTypes}}"
                                            wx:key="index"
                                            class="tile-btn {{item.selected ? 'active' : ''}}"
                                            bindtap="toggleWinType"
                                            data-name="{{item.name}}"
                                            data-multi="{{item.multi}}"
                                            data-selected="{{item.selected}}"
                                            hover-class="tile-btn-hover"
                                    >
                                        {{item.name}}
                                    </view>
                                </view>
                            </view>
                        </view>
                    </view>
                </block>


                <!-- ÈÄâÊã©ËæìÂÆ∂ -->
                <block wx:if="{{gameType !== 'Ëá™Êë∏'}}">
                    <view class="section-header">
                        <text class="section-title-user">‚òπÔ∏è ÈÄâÊã©ËæìÂÆ∂</text>
                    </view>
                    <view class="players-grid">
                        <view
                                wx:for="{{losePlayers}}"
                                wx:key="id"
                                class="player-card {{item.selected ? 'active' : ''}}"
                                bindtap="selectLosePlayer"
                                data-id="{{item.id}}"
                                data-selected="{{item.selected}}"
                        >
                            <image class="player-avatar" src="{{item.avatar}}"/>
                            <text class="player-name">{{item.username}}</text>
                        </view>
                    </view>
                </block>
            </block>
            <block wx:else>
                <scroll-view scroll-y class="scroll-view-container">
                    <view class="all-players-grid">
                        <view
                                wx:for="{{allPlayers}}"
                                wx:key="id"
                                class="all-player-card {{ item.selected ? 'active' : ''}}"
                                bindtap="selectPlayerToPlay"
                                data-id="{{item.id}}"
                                data-selected="{{item.selected}}"
                        >
                            <image class="player-avatar" src="{{item.avatar}}"/>
                            <text class="player-name">{{item.username}}</text>
                        </view>
                    </view>
                </scroll-view>
            </block>

        </view>

        <view wx:if="{{showButton}}" class="drawer-content-bottom">
            <view class="btn cancel" bindtap="closeDrawer">ÂèñÊ∂à</view>
            <view class="btn confirm" bindtap="closeDrawer">Á°ÆËÆ§Êèê‰∫§</view>
        </view>
    </view>
</view>