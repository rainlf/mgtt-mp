<!-- ÊäΩÂ±âÂÆπÂô® -->
<view class="drawer-container" wx:if="{{showDrawer}}">
    <!-- ÈÅÆÁΩ©Â±Ç -->
    <view class="mask" bindtap="closeDrawer"></view>

    <!-- ÊäΩÂ±â‰∏ª‰Ωì -->
    <view class="drawer-content">
        <!-- Êñ∞Â¢ûËÉ°ÁâåÁ±ªÂûãÈÄâÊã© -->
        <view class="drawer-content-top">
            <view class="win-type-selector">
                <text class="selector-label">ËÉ°ÁâåÔºö</text>
                <view class="type-buttons">
                    <view
                            class="type-btn {{gameType === 'ËÉ°Áâå' ? 'active' : ''}}"
                            bindtap="selectWinType"
                            data-type="ËÉ°Áâå"
                    >
                        ËÉ°Áâå
                    </view>
                    <view
                            class="type-btn {{gameType === 'Ëá™Êë∏' ? 'active' : ''}}"
                            bindtap="selectWinType"
                            data-type="Ëá™Êë∏"
                    >
                        Ëá™Êë∏
                    </view>
                    <view
                            class="type-btn {{gameType === 'Áõ∏ÂÖ¨' ? 'active' : ''}}"
                            bindtap="selectWinType"
                            data-type="Áõ∏ÂÖ¨"
                    >
                        Áõ∏ÂÖ¨
                    </view>
                </view>
            </view>
            <!-- Á¨¨‰∏ÄÈÉ®ÂàÜÔºöÊ†áÈ¢ò+Êç¢‰∫∫ÊåâÈíÆ -->
            <view class="section-header">
                <block wx:if="{{gameType === 'Áõ∏ÂÖ¨'}}">
                    <text class="section-title-user">ü¶Ü ÈÄâÊã©Áõ∏ÂÖ¨</text>
                </block>
                <block wx:else>
                    <text class="section-title-user">üôÇ ÈÄâÊã©Ëµ¢ÂÆ∂</text>
                </block>
                <text wx:if="{{!changingPlayers}}" class="replace-btn" bindtap="startChangePlayers">üîÑ ÁâåÊ°åÊç¢‰∫∫</text>
                <text wx:else class="replace-btn" bindtap="stopChangePlayers">üçÑ Á°ÆËÆ§</text>
            </view>

            <!-- Á¨¨‰∫åÈÉ®ÂàÜÔºöÁé©ÂÆ∂ÂàóË°® -->
            <block wx:if="{{!changingPlayers}}">
                <!-- Ëµ¢ÂÆ∂ÂàóË°® -->
                <view class="players-grid">
                    <view
                            wx:for="{{winPlayers}}"
                            wx:key="id"
                            class="player-card {{item.selected ? 'active' : ''}} {{item.lastSelected ? 'last-active' : ''}}"
                            bindtap="selectWinPlayer"
                            data-id="{{item.id}}"
                            data-selected="{{item.selected}}"
                            data-lastSelected="{{item.lastSelected}}"
                    >
                        <image class="player-avatar" src="{{item.avatar}}"/>
                        <text class="player-name">{{item.username}}</text>
                    </view>
                </view>
                <!-- ËÆ∞ÂàÜÂå∫Âüü -->
                <block
                        wx:if="{{gameType !== 'Áõ∏ÂÖ¨'}}"
                        wx:for="{{winPlayers}}"
                        wx:key="id"
                        wx:for-item="user"
                >
                    <view
                            wx:if="{{user.lastSelected}}"
                            class="detail-box last-active"
                    >
                        <!-- ÂæóÂàÜËÆ°ÁÆóÂå∫Âüü -->
                        <view class="detail-content">
                            <view class="detail-row">
                                <view class="detail-row-title">
                                    <text>{{user.username}} </text>
                                    <text class="detail-title">ÂæóÂàÜ:</text>
                                    <text style="margin-left: 10rpx">{{user.gameInfo.basePoints}}</text>
                                    <text style="margin-left: 10rpx"> x</text>
                                    <text style="margin-left: 10rpx">{{user.gameInfo.multi}}</text>
                                    <text style="margin-left: 10rpx"> =</text>
                                    <text style="margin-left: 10rpx">{{user.gameInfo.basePoints * user.gameInfo.multi}}</text>
                                </view>

                                <view
                                        class="delete-btn"
                                        bindtap="handleDelete"
                                        data-id="{{user.id}}"
                                        hover-class="delete-btn-hover"
                                >
                                    x
                                </view>
                            </view>

                            <!-- Â∫ïÂàÜÂå∫Âüü -->
                            <text class="section-title">ÈÄâÊã©Â∫ïÂàÜ</text>
                            <view class="button-row">
                                <view class="tag-group">
                                    <view
                                            wx:for="{{points}}"
                                            wx:key="index"
                                            class="tag-btn {{item.selected ? 'active' : ''}}"
                                            bindtap="selectBasePoints"
                                            data-name="{{item.name}}"
                                            data-selected="{{item.selected}}"
                                            data-point="{{item.point}}"
                                            data-userId="{{user.id}}"
                                            hover-class="tag-btn-hover"
                                    >
                                        {{item.name}}
                                    </view>
                                </view>

                                <!-- Êìç‰ΩúÊåâÈíÆÁªÑ -->
                                <view class="action-group">
                                    <view
                                            class="action-btn minus"
                                            bindtap="handleDecrease"
                                            data-userId="{{user.id}}"
                                            hover-class="action-btn-hover"
                                    >
                                        <text>‚àí</text>
                                    </view>
                                    <view
                                            class="action-btn plus"
                                            bindtap="handleIncrease"
                                            data-userId="{{user.id}}"
                                            hover-class="action-btn-hover"
                                    >
                                        +
                                    </view>
                                </view>
                            </view>

                            <!-- ÁâåÂûãÈÄâÊã©Âå∫Âùó -->
                            <view class="section">
                                <text class="section-title">ÈÄâÊã©ÁâåÂûã</text>
                                <view class="tile-group">
                                    <view
                                            wx:for="{{winTypes}}"
                                            wx:key="index"
                                            class="tile-btn {{item.selected ? 'active' : ''}}"
                                            bindtap="toggleWinType"
                                            data-name="{{item.name}}"
                                            data-multi="{{item.multi}}"
                                            data-selected="{{item.selected}}"
                                            data-userId="{{user.id}}"
                                            hover-class="tile-btn-hover"
                                    >
                                        {{item.name}}
                                    </view>
                                </view>
                            </view>
                        </view>
                    </view>
                </block>
                <!-- ËæìÂÆ∂ÂàóË°® -->
                <block wx:if="{{gameType === 'ËÉ°Áâå'}}">
                    <view class="section-header">
                        <text class="section-title-user">‚òπÔ∏è ÈÄâÊã©ËæìÂÆ∂</text>
                    </view>
                    <view class="players-grid">
                        <view
                                wx:for="{{losePlayers}}"
                                wx:key="id"
                                class="player-card {{item.selected ? 'active' : ''}} {{item.selected ? 'last-active' : ''}}"
                                bindtap="selectLosePlayer"
                                data-id="{{item.id}}"
                                data-selected="{{item.selected}}"
                        >
                            <image class="player-avatar" src="{{item.avatar}}"/>
                            <text class="player-name">{{item.username}}</text>
                        </view>
                    </view>
                </block>
            </block>
            <block wx:else>
                <scroll-view scroll-y class="scroll-view-container">
                    <view class="all-players-grid">
                        <view
                                wx:for="{{allPlayers}}"
                                wx:key="id"
                                class="all-player-card {{ item.selected ? 'active' : ''}} {{ item.selected ? 'last-active' : ''}}"
                                bindtap="selectPlayerToPlay"
                                data-id="{{item.id}}"
                                data-selected="{{item.selected}}"
                        >
                            <image class="player-avatar" src="{{item.avatar}}"/>
                            <text class="player-name">{{item.username}}</text>
                        </view>
                    </view>
                </scroll-view>
            </block>

        </view>

        <view wx:if="{{showButton}}" class="drawer-content-bottom">
            <view class="btn cancel" bindtap="closeDrawer">ÂèñÊ∂à</view>
            <view class="btn confirm" bindtap="showSubmit">Á°ÆËÆ§Êèê‰∫§</view>
        </view>
    </view>
</view>